<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHIRTORA Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        /* Custom styles for the switch component */
        .toggle-switch {
            @apply relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in;
        }
        .toggle-switch input {
            @apply hidden;
        }
        .toggle-label {
            @apply block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer;
        }
        .toggle-label:before {
            content: "";
            @apply absolute block w-4 h-4 mt-1 ml-1 rounded-full bg-white transition duration-200 ease-in;
        }
        input:checked + .toggle-label {
            @apply bg-blue-500;
        }
        input:checked + .toggle-label:before {
            transform: translateX(1.25rem); /* 20px - 50% width + 4px for padding/margin */
        }

        /* Specific styles for the red switch */
        .toggle-red input:checked + .toggle-label {
            @apply bg-red-500;
        }
    </style>
    <script>
        // Simple script to handle mobile sidebar toggle
        document.addEventListener('DOMContentLoaded', () => {
            const menuButton = document.getElementById('menu-button');
            const sidebar = document.getElementById('sidebar');

            menuButton.addEventListener('click', () => {
                sidebar.classList.toggle('-translate-x-full');
            });
        });
    </script>
</head>
<body class="bg-gray-100 min-h-screen flex">

    <div class="fixed top-4 left-4 z-40 lg:hidden">
        <button id="menu-button" class="p-2 text-gray-700 bg-white rounded-md shadow">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
        </button>
    </div>

    <aside id="sidebar" class="fixed inset-y-0 left-0 z-30 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out bg-white w-64 p-4 shadow-lg flex flex-col justify-between lg:static lg:h-auto">
        <%-include('../../view/partials/admin/sideBar')%>
    </aside>

    <div class="flex-1 p-4 lg:p-8 overflow-auto">
        
        <header class="mb-6 flex justify-center">
            <div class="w-full max-w-lg relative">
                <input type="search" id="search" placeholder="Search" class="w-full p-2 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <svg class="w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            </div>
        </header>

        <section class="bg-white p-6 rounded-xl shadow-md">
            
            <div class="flex justify-end mb-4">
              <a href="/admin/addbrand">
                <button class="flex items-center bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 transition duration-150">
                    <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                    Add Brand +
                </button>
                </a>
            </div>

            <div class="overflow-x-auto">
  <table class="min-w-full border border-gray-200 rounded-lg overflow-hidden">
    <thead>
      <tr class="bg-blue-500 text-white">
        <th scope="col" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider rounded-tl-lg">
          S.No
        </th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider">
          Logo
        </th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider">
          Brand Name
        </th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider">
          Description
        </th>
        <th scope="col" class="px-6 py-3 text-center text-xs font-semibold uppercase tracking-wider rounded-tr-lg">
          List / Unlist
        </th>
      </tr>
    </thead>

    <tbody class="bg-white divide-y divide-gray-200">
      
    </tbody>
  </table>
<!-- Pagination -->
  
    <nav id="pagination" class="flex justify-center space-x-2">
  
    </nav>
  </div>
</div>
</section>
</div>
<script>
  document.addEventListener('DOMContentLoaded',()=>{
    function blockUnblockListener(){    
      const buttons= document.querySelectorAll('.block-btn,.unblock-btn');
      buttons.forEach(button=>{
      button.addEventListener('click', async (e)=>{
                
      const target= e.currentTarget
      const brandId = target.dataset.id               
      const action= target.dataset.action
                
      const isBlock= action=="blockbrand"
      const titleText= isBlock?"Block this user":"Unblock this user"
      const confirmText= isBlock?"Yes, block":"Yes, Unblock"
      const successText= isBlock?"Brand has been blocked!":"Brand has been unblocked"

      const result = await Swal.fire({
      title: titleText,
      text: "Are you sure you want to proceed?",
      icon: "warning",
      showCancelButton: true,
      confirmButtonColor: isBlock ? "#d33" : "#3085d6",
      cancelButtonColor: "#aaa",
      confirmButtonText: confirmText,
      });
               
if(result.isConfirmed){
    try {
        const response= await fetch(`/admin/${action}`,{
            method:"post",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({id:brandId})
        })
        const data=await response.json()
        
            if(data.success){
            if(action =="blockbrand"){
                target.textContent="Unblock"
                target.className = "text-xs bg-green-100 text-green-600 px-2 py-1 rounded-md unblock-btn";
                target.dataset.action="unblockbrand"
            }
            else{
                target.textContent="Block"
                target.className = "text-xs bg-orange-100 text-orange-600 px-2 py-1 rounded-md block-btn";
                target.dataset.action="blockbrand"
            }
            Swal.fire({
            title: "Success!",
            text: successText,
            icon: "success",
            timer: 1200,
            showConfirmButton: false
            })
        }
        else{
            Swal.fire("Error!", "Action failed. Try again.", "error");
        }
    } catch (error) {
        Swal.fire("Error!", "Something went wrong!", "error");
        console.error("Error on brand UI:", error);
      }
  }
    })
  })
    }
      const searchInput= document.getElementById('search')
      const brandTable= document.querySelector('tbody')
      const pagination = document.getElementById('pagination')

      let currentPage=1
      let totalPages=1
      let searchTerm=""

      async function fetchBrands(page=1,search="") {
        const res= await fetch(`/admin/brand/data?page=${page}&search=${search}`)
        const data=await res.json()

        if(res.ok){
          renderTable(data.data)
          currentPage= data.currentPage
          totalPages= data.totalPages
          renderPagination()
          blockUnblockListener()
        }
      }

  function renderTable(brands) {
  brandTable.innerHTML = brands.map((val, i) => `
    <tr class="hover:bg-gray-50">
      <td class="px-6 py-4 text-sm font-medium text-gray-900">${i + 1}</td>
      <td class="px-6 py-4">
        <img src="${val.brandImage}" alt="Logo" class="h-10 w-10 rounded-full object-cover"/>
      </td>
      <td class="px-6 py-4 text-sm text-gray-800">${val.brandName}</td>
      <td class="px-6 py-4 text-sm text-gray-500 max-w-xs truncate">${val.description}</td>
      <td class="px-6 py-4 text-center space-x-2">

        <a href="/admin/editBrand/${val._id}">
          <button class="text-xs bg-blue-100 text-blue-600 px-3 py-1 rounded-md hover:bg-blue-200 transition">
            Edit
          </button>
        </a>

        ${val.isBlocked 
          ? `<button data-id="${val._id}" data-action="unblockbrand"
              class="unblock-btn text-xs bg-green-100 text-green-600 px-3 py-1 rounded-md hover:bg-green-200 transition">
              Unblock
             </button>`
          : `<button data-id="${val._id}" data-action="blockbrand"
              class="block-btn text-xs bg-red-100 text-red-600 px-3 py-1 rounded-md hover:bg-red-200 transition">
              Block
             </button>`}
      </td>
    </tr>
  `).join('');
}

  function renderPagination(){
        let pagesHTML=""
        for(let i=1;i<=totalPages;i++){
        pagesHTML+=`
          <button class="px-3 py-1 border rounded-md ${i == currentPage ? 'bg-indigo-500 text-white' : 'text-gray-600 hover:bg-gray-100' }"
          data-page="${i}">
          ${i}
          </button>`
        }

        pagination.innerHTML=`
        <div class="flex justify-center mt-6">
          <button
          id="prevBtn" 
          ${currentPage==1?"disabled":""} class="px-3 py-1 border rounded-md text-gray-600 hover:bg-gray-100">
            Previous
          </button>

          ${pagesHTML}

          <button
          ${currentPage === totalPages ? "disabled" : ""}
          id="nextBtn"
          class="px-3 py-1 border rounded-md text-gray-700 hover:bg-gray-100 disabled:opacity-50"
        >
          Next
        </button>
      </div>
        `
    
    

    document.getElementById('prevBtn')?.addEventListener('click',()=>{
          if(currentPage>1) fetchBrands(currentPage-1,searchTerm)
      })
    document.getElementById('nextBtn').addEventListener('click',()=>{
      if(currentPage<totalPages) fetchBrands(currentPage+1,searchTerm)
    })
    document.querySelectorAll("[data-page]").forEach((btn)=>{
      btn.addEventListener('click',()=>{
        const page= Number(btn.getAttribute('data-page'))
        fetchBrands(page,searchTerm)
      })
    })
  }


  let searchTimer;
    searchInput.addEventListener('input',()=>{
      clearTimeout(searchTimer)
      searchTimer= setTimeout(()=>{
          searchTerm= searchInput.value.trim()
        fetchBrands(1,searchTerm)
      },400)
    })
    fetchBrands()

    })

      
  </script>
</body>
</html>