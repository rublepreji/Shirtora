<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Offer Management Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the dark sidebar background and scrollbar (optional) */
        body {
            background-color: #f7f7f7; /* Light background for the overall page */
        }
    </style>
</head>
<body class="min-h-screen">

    <div class="flex min-h-screen bg-gray-50">

        <%-include('../../view/partials/admin/sideBar')%>
        
        <main class="flex-1 lg:ml-64 p-4 md:p-8">
            
            <header class="w-full mb-8 flex justify-between items-center h-16">
                <div class="flex-1 max-w-lg">
                    <div class="relative">
    <input
        type="text"
        id="searchInput"
        placeholder="Search"
        class="w-full py-2 pl-12 pr-10 text-gray-700 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
    />

    <!-- Search Icon -->
    <svg class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500"
        fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
    </svg>

    <!-- Clear Button -->
    <button
        id="clearSearchBtn"
        type="button"
        class="hidden absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-700"
        onclick="clearSearch()">
        âœ•
    </button>
</div>

                </div>
                
                <div>
                    <a href="/admin/addoffer">
                    <button class="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition duration-150 ease-in-out whitespace-nowrap">
                        Add Offer
                    </button>
                    </a>
                </div>
            </header>

            <div class="bg-white p-6 rounded-lg shadow-xl overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-200">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Offer Name</th>
                            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">OfferType</th>
                            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Offer</th>
                            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Selected (Product/Category)</th>
                            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Expiry Date</th>
                            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Status</th>
                            <th class="px-6 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="offerTable" class="bg-white divide-y divide-gray-200">
                       
                    </tbody>
                </table>
            </div>

        </main>

    </div>

    <div id="paginationWrapper" class="flex justify-center mt-8 gap-2">

    </div>

    <script>
        const searchInput= document.getElementById('searchInput') 
        const clearBtn= document.getElementById('clearSearchBtn')
        async function loadOffers(page=1,search='') {
            try {         
                const result=await fetch(`/admin/dataforofferlist?page=${page}&search=${encodeURIComponent(search)}`)
                const data= await result.json();
                console.log(data);
                
                if(data.success){
                    renderTable(data.data)
                    renderPagination(data.currentPage,data.totalPages,search)
                }
            }catch (error) {
                console.log('Error from offerList',error);
                throw error
            }
        }
        function renderTable(data) {
            const tbody= document.getElementById('offerTable')
            tbody.innerHTML=''
            data.forEach((item,i)=>{
                let status=item.isActive? `<p
                class="px-2 py-1 text-sm font-semibold rounded-full 
                    bg-green-100 text-green-700">
                Active
                </p>`:`<p
                class="px-4 py-1.5 text-sm font-semibold rounded-full 
                    bg-red-100 text-red-700">
                Inactive
                </p>`
                tbody.innerHTML+=`
                <tr>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.title}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"> ${item.type}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.productOffer || item.categoryOffer}%</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.appliedOn}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${new Date(item.endDate).toDateString()}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${status}</td>
                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium flex justify-center space-x-2">
                    <button class="text-indigo-600 hover:text-indigo-900 p-1">
                       <a href="/admin/editoffer/${item._id}"> <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg></a>
                    </button>
                    <button class="text-red-600 hover:text-red-900 p-1">
                        <a href="/admin/deleteoffer/${item._id}"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></a>
                    </button>
                </td>
                </tr>
            `})
        }


        function renderPagination(current, total, search) {
            const wrapper = document.getElementById("paginationWrapper");
            wrapper.innerHTML = "";

            if (current > 1) {
                wrapper.innerHTML += `<button class="px-4 py-2 bg-gray-200 rounded" onclick="loadOffers(${current - 1},'${search}')">Prev</button>`;
            }

            for (let i = 1; i <= total; i++) {
                wrapper.innerHTML += `
                    <button class="px-4 py-2 rounded ${current === i ? 'bg-black text-white' : 'bg-gray-200'}"
                        onclick="loadOffers(${i},'${search}')">${i}</button>
                `;
            }

            if (current < total) {
                wrapper.innerHTML += `<button class="px-4 py-2 bg-gray-200 rounded" onclick="loadOffers(${current + 1},'${search}')">Next</button>`;
            }
        }
            
        let searchTimer
        searchInput.addEventListener('input',()=>{
            clearTimeout(searchTimer)
            if(searchInput.value.trim()!==''){
                clearBtn.classList.remove('hidden')
            }else{
                clearBtn.classList.add('hidden')
            }
            searchTimer=setTimeout(()=>{
                let searchValue=searchInput.value.trim()
                loadOffers(1,searchValue)
            },400)
        })

        function clearSearch() {
            searchInput.value=''
            clearBtn.classList.add('hidden')
            loadOffers(1,'')
        }
        loadOffers(1,searchInput.value.trim())
    </script>

</body>
</html>